{
    "containerDefinitions": [
        {
            "name": "router", 
            "image": "${IMAGE_REPOSITORY}/${PROJECT_NAME}/routing:0.0.2", 
            "memory": 256, 
            "dependsOn": [
                {
                    "containerName": "nanny", 
                    "condition": "START"
                }
            ], 
            "cpu": 256,
            "logConfiguration": {
                "logDriver": "awslogs",
                "options": {
                    "awslogs-group": "feed-logs",
                    "awslogs-region": "us-west-2",
                    "awslogs-stream-prefix": "router"
                }
            },
            "portMappings": [
                {
                    "protocol": "tcp", 
                    "containerPort": 5002, 
                    "hostPort": 5002
                }
            ], 
            "environment": [
                 {"name": "LOG_LEVEL", "value": "DEBUG"},
                 {"name": "NANNY_HOST", "value": "localhost"}
            ]

        }, 
        {
            "name": "ui-server", 
            "image": "${IMAGE_REPOSITORY}/${PROJECT_NAME}/ui-server:0.0.2", 
            "memory": 500, 
            "dependsOn": [
                {
                    "containerName": "nanny", 
                    "condition": "START"
                }
            ], 
            "cpu": 512,
            "logConfiguration": {
                "logDriver": "awslogs",
                "options": {
                    "awslogs-group": "feed-logs",
                    "awslogs-region": "us-west-2",
                    "awslogs-stream-prefix": "ui-server"
                }
            },
            "portMappings": [
                {
                    "protocol": "tcp", 
                    "containerPort": 5003, 
                    "hostPort": 5003
                }
            ], 
            "environment": [
                 {"name": "DATABASE_NAME", "value": "feeds"},
                 {"name": "DATABASE_PASS", "value": "feeds"},
                 {"name": "DATABASE_USER", "value": "feeds"},
                 {"name": "DATABASE_PORT", "value": "5432"},
                 {"name": "DATABASE_HOST", "value": "localhost"},
                 {"name": "KAFKA_ADDRESS", "value": "localhost:9092"},
                 {"name": "LEADER_START", "value": "\"feed has started\""},
                 {"name": "LEADER_TEMPLATE", "value": "leader"},
                 {"name": "LEADER_BASE_PORT", "value": "9000"},
                 {"name": "LOG_LEVEL", "value": "DEBUG"},
                 {"name": "MONGO_HOST", "value": "localhost:27017"},
                 {"name": "MONGO_PASS", "value": "root"},
                 {"name": "MONGO_USER", "value": "root"},
                 {"name": "NANNY_HOST", "value": "localhost"},
                 {"name": "PARAMETER_DATABASE", "value": "params"},
                 {"name": "FORM_DATABASE", "value": "forms"},
                 {"name": "PARAM_STATS_DATABASE", "value": "params_stats"}
            ]
        }, 
        {
            "name": "commands", 
            "image": "${IMAGE_REPOSITORY}/${PROJECT_NAME}/commands:0.0.6", 
            "memory": 512, 
            "dependsOn": [
                {
                    "containerName": "nanny", 
                    "condition": "START"
                }
            ], 
            "portMappings": [
                {
                    "protocol": "tcp", 
                    "containerPort": 5001, 
                    "hostPort": 5001
                }
            ], 
            "cpu": 256,
            "logConfiguration": {
                "logDriver": "awslogs",
                "options": {
                    "awslogs-group": "feed-logs",
                    "awslogs-region": "us-west-2",
                    "awslogs-stream-prefix": "commands"
                }
            },
            "environment": [
                 {"name": "NANNY_HOST", "value": "localhost"}
            ]

        }, 
        {
            "name": "summarizer", 
            "image": "${IMAGE_REPOSITORY}/${PROJECT_NAME}/summarizer:0.0.3", 
            "memory": 1000, 
            "dependsOn": [
                {
                    "containerName": "nanny", 
                    "condition": "START"
                }
            ], 
            "cpu": 512,
            "logConfiguration": {
                "logDriver": "awslogs",
                "options": {
                    "awslogs-group": "feed-logs",
                    "awslogs-region": "us-west-2",
                    "awslogs-stream-prefix": "summarizer"
                }
            },
            "environment": [
                 {"name": "DATABASE_NAME", "value": "feeds"},
                 {"name": "DATABASE_PASS", "value": "feeds"},
                 {"name": "DATABASE_PORT", "value": "5432"},
                 {"name": "DATABASE_USER", "value": "feeds"},
                 {"name": "DATABASE_HOST", "value": "localhost"},
                 {"name": "KAFKA_ADDRESS", "value": "localhost:9092"},
                 {"name": "LOG_LEVEL", "value": "DEBUG"},
                 {"name": "NANNY_HOST", "value": "localhost"}
            ]

        }, 
        {
            "name": "feed-admin", 
            "image": "${IMAGE_REPOSITORY}/${PROJECT_NAME}/feed-admin:0.0.4", 
            "memory": 512, 
            "logConfiguration": {
                "logDriver": "awslogs",
                "options": {
                    "awslogs-group": "feed-logs",
                    "awslogs-region": "us-west-2",
                    "awslogs-stream-prefix": "feed-admin"
                }
            },
            "dependsOn": [
                {
                    "containerName": "ui-server", 
                    "condition": "START"
                }, 
                {
                    "containerName": "commands", 
                    "condition": "START"
                }
            ], 
            "portMappings": [
                {
                    "protocol": "tcp", 
                    "containerPort": 3000, 
                    "hostPort": 3000
                }
            ], 
            "cpu": 256,
            "environment": [
                 {"name": "FLASK_PORT", "value": "5000"},
                 {"name": "NETWORK", "value": "feed_default"},
                 {"name": "COMMANDSERVER", "value": "http://localhost:5001"},
                 {"name": "UISERVER", "value": "http://localhost:5004"},
                 {"name": "SELENIUM_PORT", "value": "4444"},
                 {"name": "WORKER_TIMEOUT", "value": "3"},
                 {"name": "LOGLEVEL", "value": "DEBUG"}
            ]

        }, 
        {
            "name": "nanny", 
            "image": "${IMAGE_REPOSITORY}/${PROJECT_NAME}/nanny:0.0.0", 
            "stopTimeout": 5, 
            "memory": 512, 
            "cpu": 256,
            "logConfiguration": {
                "logDriver": "awslogs",
                "options": {
                    "awslogs-group": "feed-logs",
                    "awslogs-region": "us-west-2",
                    "awslogs-stream-prefix": "nanny"
                }
            },
            "portMappings": [
                {
                    "protocol": "tcp", 
                    "containerPort": 5004, 
                    "hostPort": 5004
                }
            ], 
            "environment": [
                 {"name": "BROWSER_BASE_PORT", "value": "4444"},
                 {"name": "BROWSER_IMAGE", "value": "selenium/standalone-chrome:3.141.59"},
                 {"name": "CONTAINER_TIMEOUT", "value": "10"},
                 {"name": "KAFKA_ADDRESS", "value": "localhost:9092"},
                 {"name": "LEADER_BASE_PORT", "value": "9000"},
                 {"name": "LOG_LEVEL", "value": "DEBUG"},
                 {"name": "MAX_CONTAINERS", "value": "10"},
                 {"name": "MONGO_HOST", "value": "localhost:27017"},
                 {"name": "MONGO_PASS", "value": "root"},
                 {"name": "MONGO_USER", "value": "root"},
                 {"name": "NANNY_HOST", "value": "localhost"},
                 {"name": "NETWORK", "value": "feed_default"},
                 {"name": "PARAMETER_DATABASE", "value": "params"},
                 {"name": "PARAM_STATS_DATABASE", "value": "params_stats"},
                 {"name": "SELENIUM_PORT", "value": "4444"}
            ]
        },
        {
            "name": "leader",
            "image": "${IMAGE_REPOSITORY}/${PROJECT_NAME}/leader:0.1.1",
            "stopTimeout": 5, 
            "memory": 512, 
            "cpu": 256,
            "logConfiguration": {
                "logDriver": "awslogs",
                "options": {
                    "awslogs-group": "feed-logs",
                    "awslogs-region": "us-west-2",
                    "awslogs-stream-prefix": "leader"
                }
            },
            "dependsOn": [
                {
                    "containerName": "nanny", 
                    "condition": "START"
                },
                {
                    "containerName": "commands", 
                    "condition": "START"
                }
            ], 
            "environment": [
                {"name": "NANNY_HOST", "value": "localhost"},
                {"name": "COMMANDS_HOST", "value": "localhost"},
                {"name": "KAFKA_ADDRESS", "value": "localhost:9092"},
                {"name": "ROUTER_HOST", "value": "localhost"},
                {"name": "LOG_LEVEL", "value": "DEBUG"}
            ]
        }
    ], 
    "networkMode": "awsvpc", 
    "family": "feed-deployment-tasks", 
    "executionRoleArn": "arn:aws:iam::064106913348:role/FeedAdmin",
    "requiresCompatibilities": [
        "FARGATE"
    ], 
    "memory": "8192", 
    "cpu": "4096"

}
